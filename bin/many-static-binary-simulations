#!/usr/bin/env python

from argparse import ArgumentParser, FileType
from asyncio import run

from hashwars import many_static_binary_simulations, write_results, array_glob

_DEFAULT_ERROR = 0.01

_parser = ArgumentParser(description="Run many static binary simulations.")
_parser.add_argument("-o", "--output", type=FileType('wb'), help="write to FILE", metavar="FILE")
_parser.add_argument("-e", "--error-rate", help="target error rate", metavar="VALUE", type=float, default=_DEFAULT_ERROR)
_parser.add_argument("name", help="simulator function", metavar="NAME")
_parser.add_argument("distances", help="min & max distance (array)", metavar="DISTANCES", type=array_glob)
_parser.add_argument("hashrate_ratios", help="min & max attacker/defender hashrate ratio (array)", metavar="RATIOS", type=array_glob)

if __name__ == '__main__':

    args = _parser.parse_args()

    import simulations

    results = run(many_static_binary_simulations(simulations, args.name, args.distances, args.hashrate_ratios, args.error_rate))
    write_results(results, args.output)
